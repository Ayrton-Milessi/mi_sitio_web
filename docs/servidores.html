<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Encabezados de Servidores Web</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <header>
        <nav>
            <ul>
                <li><a href="index.html">Inicio</a></li>
                <li><a href="pagina_1.html">Experiencia</a></li>
                <li><a href="pagina_2.html">Proyectos</a></li>
                <li><a href="pagina_3.html">Formaci贸n</a></li>
                <li><a href="servidores.html">Servidores Web</a></li>
            </ul>
        </nav>
    </header>
    <main>
        <section class="section" style="background: #f8f9fa; border-radius: 16px; box-shadow: 0 2px 12px rgba(0,0,0,0.07); padding: 0px 0px; margin: 0px auto 0px auto; max-width: 1000px;">
            <h2 style="color:#0077b6; font-size:2em; margin-bottom:0px; text-align:center; letter-spacing:1px;">
                <span style="font-size:1.3em;">&#128187;</span> Encabezados de 5 servidores web
            </h2>
            <ul id="servidores-list" style="margin-bottom:24px; list-style:none; padding:0;">
                <li style="margin-bottom:10px; padding:8px 0; border-bottom:1px solid #e0e0e0; text-align: center;">
                    <span style="font-weight:bold; color:#009688;">Google:</span>
                    <span style="color:#333;">https://www.google.com</span>
                </li>
                <li style="margin-bottom:10px; padding:8px 0; border-bottom:1px solid #e0e0e0; text-align: center;">
                    <span style="font-weight:bold; color:#009688;">GitHub:</span>
                    <span style="color:#333;">https://www.github.com</span>
                </li>
                <li style="margin-bottom:10px; padding:8px 0; border-bottom:1px solid #e0e0e0; text-align: center;">
                    <span style="font-weight:bold; color:#009688;">Wikipedia:</span>
                    <span style="color:#333;">https://www.wikipedia.org</span>
                </li>
                <li style="margin-bottom:10px; padding:8px 0; border-bottom:1px solid #e0e0e0; text-align: center;">
                    <span style="font-weight:bold; color:#009688;">Microsoft:</span>
                    <span style="color:#333;">https://www.microsoft.com</span>
                </li>
                <li style="margin-bottom:10px; padding:8px 0; border-bottom:1px solid #e0e0e0; text-align: center;">
                    <span style="font-weight:bold; color:#009688;">Cloudflare:</span>
                    <span style="color:#333;">https://www.cloudflare.com</span>
                </li>
            </ul>
            <div style="text-align:center;">
                <button class="button" onclick="listarEncabezados()" style="background:linear-gradient(90deg,#00b4d8 60%,#90e0ef 100%); color:#fff; font-weight:bold; border:none; border-radius:6px; padding:12px 28px; font-size:1.1em; box-shadow:0 2px 8px rgba(0,0,0,0.10); cursor:pointer; transition:background 0.2s;">
                    &#128269; Listar encabezados
                </button>
            </div>
            <!-- <div id="resultados"></div> -->
        </section>
    </main>

<h2 style="margin-top:10px;">Comparaci贸n entre fetch() y cURL</h2>
<div style="background:linear-gradient(90deg,#00b4d8 60%,#90e0ef 100%); color:#fff; border-radius:8px; padding:14px 18px; margin:18px 0; box-shadow:0 2px 8px rgba(0,0,0,0.10); font-size:1.08em;">
    <span style="font-weight:bold; font-size:1.15em; vertical-align:middle;">&#9888;&#65039; Importante:</span>
    Para que funcionen las peticiones <span style="font-weight:bold;">fetch</span> de JavaScript, primero debes acceder a <a href="https://cors-anywhere.herokuapp.com/corsdemo" target="_blank" style="color:#e03330; text-decoration:underline; font-weight:bold;">https://cors-anywhere.herokuapp.com</a> y permitir temporalmente la <span style="font-weight:bold;">interacci贸n con servidores externos</span>.<br>
    <span style="font-size:0.98em; color:#e0e0e0;">Al apretar el bot贸n "Listar encabezados", se realizar谩n las peticiones correspondientes y se formar谩 una tabla comparativa de los resultados claves.</span>
</div>

<table style="width:100%; border-collapse:collapse; margin-bottom:32px; box-shadow:0 2px 8px rgba(0,0,0,0.08);">
  <thead style="background:linear-gradient(90deg,#00b4d8 60%,#90e0ef 100%); color:#fff;">
    <tr>
      <th style="padding:10px;">Sitio</th>
      <th style="padding:10px;">Encabezados con fetch()</th>
      <th style="padding:10px;">Encabezados con cURL (PHP)</th>
    </tr>
  </thead>
  <tbody id="tabla-comparacion">
    <tr>
      <td>Google</td>
    <td><div class="resultado-cell"><button class="toggle-btn" onclick="toggleResultado('fetch-google')">Mostrar/Ocultar</button><div id="fetch-google" class="resultado-content">(Haz clic en "Listar encabezados" para ver los resultados)</div></div></td>
    <td><div class="resultado-cell"><button class="toggle-btn" onclick="toggleResultado('curl-google')">Mostrar/Ocultar</button><div id="curl-google" class="resultado-content">(Haz clic en "Listar encabezados" para ver los resultados)</div></div></td>
    </tr>
    <tr>
      <td>GitHub</td>
    <td><div class="resultado-cell"><button class="toggle-btn" onclick="toggleResultado('fetch-github')">Mostrar/Ocultar</button><div id="fetch-github" class="resultado-content">(Haz clic en "Listar encabezados" para ver los resultados)</div></div></td>
    <td><div class="resultado-cell"><button class="toggle-btn" onclick="toggleResultado('curl-github')">Mostrar/Ocultar</button><div id="curl-github" class="resultado-content">(Haz clic en "Listar encabezados" para ver los resultados)</div></div></td>
    </tr>
    <tr>
      <td>Wikipedia</td>
    <td><div class="resultado-cell"><button class="toggle-btn" onclick="toggleResultado('fetch-wikipedia')">Mostrar/Ocultar</button><div id="fetch-wikipedia" class="resultado-content">(Haz clic en "Listar encabezados" para ver los resultados)</div></div></td>
    <td><div class="resultado-cell"><button class="toggle-btn" onclick="toggleResultado('curl-wikipedia')">Mostrar/Ocultar</button><div id="curl-wikipedia" class="resultado-content">(Haz clic en "Listar encabezados" para ver los resultados)</div></div></td>
    </tr>
    <tr>
      <td>Microsoft</td>
    <td><div class="resultado-cell"><button class="toggle-btn" onclick="toggleResultado('fetch-microsoft')">Mostrar/Ocultar</button><div id="fetch-microsoft" class="resultado-content">(Haz clic en "Listar encabezados" para ver los resultados)</div></div></td>
    <td><div class="resultado-cell"><button class="toggle-btn" onclick="toggleResultado('curl-microsoft')">Mostrar/Ocultar</button><div id="curl-microsoft" class="resultado-content">(Haz clic en "Listar encabezados" para ver los resultados)</div></div></td>
    </tr>
    <tr>
      <td>Cloudflare</td>
    <td><div class="resultado-cell"><button class="toggle-btn" onclick="toggleResultado('fetch-cloudflare')">Mostrar/Ocultar</button><div id="fetch-cloudflare" class="resultado-content">(Haz clic en "Listar encabezados" para ver los resultados)</div></div></td>
    <td><div class="resultado-cell"><button class="toggle-btn" onclick="toggleResultado('curl-cloudflare')">Mostrar/Ocultar</button><div id="curl-cloudflare" class="resultado-content">(Haz clic en "Listar encabezados" para ver los resultados)</div></div></td>
    </tr>
  </tbody>
</table>

<h2 style="margin-top:40px;">Resultados de la comparaci贸n</h2>
<div id="resultados-comparacion"></div>
<script>
// Escucha el evento personalizado y muestra la comparaci贸n de forma visual y clara
document.addEventListener("tablaEncabezadosLista", function(e) {
    const resultados = e.detail;
    let html = `
    <table style="width:100%; border-collapse:collapse; margin-bottom:32px; box-shadow:0 2px 8px rgba(0,0,0,0.10); font-size:1em;">
      <thead style="background:linear-gradient(90deg,#00b4d8 60%,#90e0ef 100%); color:#fff;">
        <tr>
          <th style="padding:12px;">Sitio</th>
          <th style="padding:12px;">Encabezados en com煤n</th>
          <th style="padding:12px;">Solo en fetch()</th>
          <th style="padding:12px;">Solo en cURL (PHP)</th>
        </tr>
      </thead>
      <tbody>
    `;
    for (const sitio in resultados) {
        const fetch = resultados[sitio].fetch || {};
        const curl = resultados[sitio].curl || {};

        // Encabezados en com煤n
        const comunes = Object.keys(fetch).filter(k => k in curl);
        // Solo en fetch
        const soloFetch = Object.keys(fetch).filter(k => !(k in curl));
        // Solo en cURL
        const soloCurl = Object.keys(curl).filter(k => !(k in fetch));

        html += `<tr>
            <td style="vertical-align:top; font-weight:bold; background:#f1f8fb; padding:10px 12px;">${sitio}</td>
            <td style="vertical-align:top; background:#e7f6ff; padding:10px 12px;">
                ${comunes.length ? '<ul style="margin:0; padding-left:18px;">' + comunes.map(k => `<li><strong>${k}:</strong> <span style="color:#0077b6;">${fetch[k]}</span></li>`).join('') + '</ul>' : '<span style="color:#888;">Ninguno</span>'}
            </td>
            <td style="vertical-align:top; background:#f6fff7; padding:10px 12px;">
                ${soloFetch.length ? '<ul style="margin:0; padding-left:18px;">' + soloFetch.map(k => `<li><strong>${k}:</strong> <span style="color:#009688;">${fetch[k]}</span></li>`).join('') + '</ul>' : '<span style="color:#888;">Ninguno</span>'}
            </td>
            <td style="vertical-align:top; background:#fff6f6; padding:10px 12px;">
                ${soloCurl.length ? '<ul style="margin:0; padding-left:18px;">' + soloCurl.map(k => {
                    let valor = curl[k];
                    if (Array.isArray(valor)) valor = valor.join(', ');
                    return `<li><strong>${k}:</strong> <span style="color:#e76f51;">${valor}</span></li>`;
                }).join('') + '</ul>' : '<span style="color:#888;">Ninguno</span>'}
            </td>
        </tr>`;
    }
    html += `</tbody></table>`;
    document.getElementById("resultados-comparacion").innerHTML = html;
});
</script>
    <!-- Aqu铆 se mostrar谩n los resultados de la comparaci贸n -->

    <footer>
        <div class="social-icons">
            <a href="https://www.linkedin.com/in/ayrton-milessi/" target="_blank"><img src="../imagenes/linkedin.jpg" alt="LinkedIn"></a>
            <a href="https://github.com/Ayrton-Milessi" target="_blank"><img src="../imagenes/github.png" alt="GitHub"></a>
            <a href="https://www.instagram.com/ayrton.21/" target="_blank"><img src="../imagenes/instagram.jpg" alt="Instagram"></a>
        </div>
        <p class="copyright">&copy; 2025 - Ayrton Milessi</p>
    </footer>
    <style>
    .resultado-cell {
        position: relative;
        min-width: 180px;
        max-width: 400px;
    }
    .resultado-content {
        max-height: 120px;
        overflow-y: auto;
        background: #f8f9fa;
        border: 1px solid #e0e0e0;
        padding: 6px 8px;
        margin-top: 4px;
        font-size: 0.95em;
        transition: max-height 0.3s;
    }
    .toggle-btn {
        font-size: 0.85em;
        background: #00b4d8;
        color: #fff;
        border: none;
        border-radius: 4px;
        padding: 2px 8px;
        cursor: pointer;
        margin-bottom: 2px;
    }
    </style>
    <script src="../app.js"></script>
    <script src="../resultado.js"></script>
    <script>
    function toggleResultado(id) {
        const el = document.getElementById(id);
        if (!el) return;
        if (el.style.display === "none") {
            el.style.display = "block";
        } else {
            el.style.display = "none";
        }
    }
    // Mostrar por defecto los resultados
    document.addEventListener('DOMContentLoaded', function() {
        document.querySelectorAll('.resultado-content').forEach(function(el) {
            el.style.display = 'block';
        });
    });
    // ...existing code...
async function listarEncabezados() {
    const urls = [
        { nombre: "Google", url: "https://www.google.com", idFetch: "fetch-google", idCurl: "curl-google" },
        { nombre: "GitHub", url: "https://www.github.com", idFetch: "fetch-github", idCurl: "curl-github" },
        { nombre: "Wikipedia", url: "https://www.wikipedia.org", idFetch: "fetch-wikipedia", idCurl: "curl-wikipedia" },
        { nombre: "Microsoft", url: "https://www.microsoft.com", idFetch: "fetch-microsoft", idCurl: "curl-microsoft" },
        { nombre: "Cloudflare", url: "https://www.cloudflare.com", idFetch: "fetch-cloudflare", idCurl: "curl-cloudflare" }
    ];

    // Nuevo: objeto para guardar todos los resultados
    const resultados = {};

    for (const sitio of urls) {
        document.getElementById(sitio.idFetch).innerHTML = "Consultando...";
        document.getElementById(sitio.idCurl).innerHTML = "Consultando...";

        resultados[sitio.nombre] = { fetch: {}, curl: {} }; // inicializamos

        // FETCH (solo si CORS lo permite)
        try {
            const headers = await obtenerEncabezados(sitio.url);
            if (headers.error) {
                document.getElementById(sitio.idFetch).innerHTML = `<span style='color:red;'>Error: ${headers.error}</span>`;
            } else {
                let lista = "<ul style='font-size:0.85em;'>";
                for (const clave in headers) {
                    lista += `<li><strong>${clave}:</strong> ${headers[clave]}</li>`;
                }
                lista += "</ul>";
                document.getElementById(sitio.idFetch).innerHTML = lista;

                // Guardamos para la tabla comparativa
                resultados[sitio.nombre].fetch = headers;
            }
        } catch (err) {
            document.getElementById(sitio.idFetch).innerHTML = `<span style='color:red;'>Error: ${err.message}</span>`;
        }

        // CURL (PHP, mini_server.php)
        try {
            const resp = await fetch("../mini_server.php?url=" + encodeURIComponent(sitio.url));
            const text = await resp.text();

            try {
                const headersCurl = JSON.parse(text);
                if (headersCurl.error) {
                    document.getElementById(sitio.idCurl).innerHTML = `<span style='color:red;'>Error: ${headersCurl.error}</span>`;
                } else {
                    let listaCurl = "<ul style='font-size:0.85em;'>";
                    Object.entries(headersCurl).forEach(([clave, valor]) => {
                        if (Array.isArray(valor)) valor = valor.join(', ');
                        listaCurl += `<li><strong>${clave}:</strong> ${valor}</li>`;
                    });
                    listaCurl += "</ul>";
                    document.getElementById(sitio.idCurl).innerHTML = listaCurl;

                    // Guardamos para la tabla comparativa
                    resultados[sitio.nombre].curl = headersCurl;
                }
            } catch (e) {
                document.getElementById(sitio.idCurl).innerHTML = `<span style='color:red;'>Respuesta inesperada:<br><pre>${text}</pre></span>`;
            }

        } catch (err) {
            document.getElementById(sitio.idCurl).innerHTML = `<span style='color:red;'>Error: ${err.message}</span>`;
        }
    }

    //  Disparamos el evento al terminar TODO
    const evento = new CustomEvent("tablaEncabezadosLista", { detail: resultados });
    document.dispatchEvent(evento);
}

</script>
</body>
</html>